{"ast":null,"code":"var _jsxFileName = \"D:\\\\Documenti\\\\GitHub\\\\ZooGames\\\\application\\\\frontend\\\\src\\\\Giochi\\\\Quiz\\\\Game.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport EndScreen from \"./EndScreen.js\";\nimport Score from \"./Score.js\";\nimport QuizItem from \"./QuizItem.js\";\nimport { supabase } from \"../../components/Database.js\"; // import { updateScore } from \"../../components/UpdateScore.js\"\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction convertDifficultyToPoints(difficulty) {\n  if (difficulty === \"easy\") return 1;else if (difficulty === \"medium\") return 2;else if (difficulty === \"hard\") return 3;else throw new Error(`Invalid difficulty setting: ${difficulty}`);\n}\n\nfunction Game(_ref) {\n  _s();\n\n  let {\n    quizData,\n    session\n  } = _ref;\n  const [playerScore, setPlayerScore] = useState('');\n  useEffect(() => {\n    const fetchData = async () => {\n      const userScore = await supabase.from('users').select('score').eq('id', session.user.id);\n      setPlayerScore(userScore);\n      console.log(\"Punteggio utente è : \" + userScore);\n    };\n\n    fetchData();\n  }, []);\n  const [gameState, setGameState] = useState({\n    score: 0,\n    triviaIndex: 0,\n    isGameOver: false,\n    startTime: performance.now()\n  });\n  const {\n    score,\n    triviaIndex,\n    isGameOver,\n    startTime\n  } = gameState;\n  const questionNumber = triviaIndex + 1;\n  const numQuestions = quizData.length;\n  const playTimeInSeconds = (performance.now() - startTime) / 1000;\n  let userId;\n\n  if (session != null) {\n    userId = session.user.id;\n  }\n\n  const restartGame = () => {\n    setGameState({\n      score: 0,\n      triviaIndex: 0,\n      isGameOver: false,\n      startTime: performance.now()\n    });\n  };\n\n  const loadNextQuestion = () => {\n    if (triviaIndex >= quizData.length - 1) {\n      setGameState({ ...gameState,\n        isGameOver: true\n      });\n    } else {\n      setGameState({ ...gameState,\n        triviaIndex: triviaIndex + 1\n      });\n    }\n  };\n\n  const onAnswerSelected = (wasPlayerCorrect, difficulty) => {\n    const pointValue = convertDifficultyToPoints(difficulty);\n\n    if (wasPlayerCorrect) {\n      setGameState({ ...gameState,\n        score: score + pointValue\n      });\n    }\n  };\n\n  let pageContent;\n  let pageKey;\n  let finalScore;\n\n  async function updateScore(userId, score) {\n    if (userId != null && isGameOver) {\n      try {\n        finalScore = 0;\n        const userScore = await supabase.from('users').select('score').eq('id', userId);\n        console.log(\"userscore: \" + userScore);\n        finalScore = parseInt(score + userScore);\n        console.log(\"Punteggio attuale: \" + finalScore);\n        await supabase.from('users').update({\n          score: finalScore\n        }).eq('id', userId);\n      } catch (err) {\n        console.log(\"Errore nell'aggiornamento del punteggio: \" + err);\n      }\n    }\n  }\n\n  if (isGameOver) {\n    pageKey = \"EndScreen\";\n    console.log(\"score: \" + score);\n    updateScore(session.user.id, score);\n    pageContent = /*#__PURE__*/_jsxDEV(EndScreen, {\n      score: score,\n      onRetryClick: restartGame,\n      playTime: playTimeInSeconds,\n      session: session\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 9\n    }, this);\n  } else {\n    pageKey = triviaIndex;\n    const triviaQuestion = quizData[triviaIndex];\n    const {\n      correct_answer,\n      incorrect_answers,\n      question,\n      difficulty\n    } = triviaQuestion;\n    pageContent = /*#__PURE__*/_jsxDEV(QuizItem, {\n      question: question,\n      difficulty: difficulty,\n      correctAnswer: correct_answer,\n      incorrectAnswers: incorrect_answers,\n      onNextClick: loadNextQuestion,\n      onAnswerSelected: onAnswerSelected\n    }, triviaIndex, false, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Score, {\n      score: score,\n      questionNumber: questionNumber,\n      totalQuestions: numQuestions\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), pageContent]\n  }, void 0, true);\n}\n\n_s(Game, \"ouo9KTevnfzwVDvZzAObAToiPoE=\");\n\n_c = Game;\nexport default Game;\n\nvar _c;\n\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"names":["useEffect","useState","EndScreen","Score","QuizItem","supabase","convertDifficultyToPoints","difficulty","Error","Game","quizData","session","playerScore","setPlayerScore","fetchData","userScore","from","select","eq","user","id","console","log","gameState","setGameState","score","triviaIndex","isGameOver","startTime","performance","now","questionNumber","numQuestions","length","playTimeInSeconds","userId","restartGame","loadNextQuestion","onAnswerSelected","wasPlayerCorrect","pointValue","pageContent","pageKey","finalScore","updateScore","parseInt","update","err","triviaQuestion","correct_answer","incorrect_answers","question"],"sources":["D:/Documenti/GitHub/ZooGames/application/frontend/src/Giochi/Quiz/Game.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport EndScreen from \"./EndScreen.js\";\r\nimport Score from \"./Score.js\";\r\nimport QuizItem from \"./QuizItem.js\";\r\nimport { supabase } from \"../../components/Database.js\";\r\n// import { updateScore } from \"../../components/UpdateScore.js\"\r\n\r\nfunction convertDifficultyToPoints(difficulty) {\r\n  if (difficulty === \"easy\") return 1;\r\n  else if (difficulty === \"medium\") return 2;\r\n  else if (difficulty === \"hard\") return 3;\r\n  else throw new Error(`Invalid difficulty setting: ${difficulty}`);\r\n}\r\n\r\nfunction Game({ quizData, session }) {\r\n  const [playerScore,setPlayerScore] = useState('')\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n        const userScore = await supabase.from('users').select('score').eq('id',session.user.id)\r\n        setPlayerScore(userScore)\r\n        console.log(\"Punteggio utente è : \" + userScore)\r\n    }\r\n    fetchData()\r\n\r\n}, [])\r\n\r\n  const [gameState, setGameState] = useState({\r\n    score: 0,\r\n    triviaIndex: 0,\r\n    isGameOver: false,\r\n    startTime: performance.now(),\r\n  });\r\n\r\n  const { score, triviaIndex, isGameOver, startTime } = gameState;\r\n  const questionNumber = triviaIndex + 1;\r\n  const numQuestions = quizData.length;\r\n  const playTimeInSeconds = (performance.now() - startTime) / 1000;\r\n\r\n  let userId;\r\n\r\n  if(session!=null){\r\n    userId = session.user.id;\r\n  }\r\n  \r\n\r\n  const restartGame = () => {\r\n    setGameState({\r\n      score: 0,\r\n      triviaIndex: 0,\r\n      isGameOver: false,\r\n      startTime: performance.now(),\r\n    });\r\n  };\r\n\r\n  const loadNextQuestion = () => {\r\n    if (triviaIndex >= quizData.length - 1) {\r\n      setGameState({ ...gameState, isGameOver: true });\r\n    } else {\r\n      setGameState({ ...gameState, triviaIndex: triviaIndex + 1 });\r\n    }\r\n  };\r\n\r\n  const onAnswerSelected = (wasPlayerCorrect, difficulty) => {\r\n    const pointValue = convertDifficultyToPoints(difficulty);\r\n    if (wasPlayerCorrect) {\r\n      setGameState({\r\n        ...gameState,\r\n        score: score + pointValue,\r\n      });\r\n    }\r\n  };\r\n\r\n  let pageContent;\r\n  let pageKey;\r\n  let finalScore;\r\n  async function updateScore(userId, score) {\r\n    if (userId != null && isGameOver) {\r\n        try {\r\n            finalScore = 0\r\n            const userScore = await supabase.from('users').select('score').eq('id', userId);\r\n            console.log(\"userscore: \" + userScore)\r\n            finalScore = parseInt(score + userScore);\r\n            console.log(\"Punteggio attuale: \" + finalScore);\r\n            await supabase.from('users').update({ score: finalScore }).eq('id', userId);\r\n        } catch (err) {\r\n            console.log(\"Errore nell'aggiornamento del punteggio: \" + err);\r\n        }\r\n    }\r\n  }\r\n\r\n  if (isGameOver) {\r\n    pageKey = \"EndScreen\";\r\n    console.log(\"score: \" + score)\r\n    updateScore(session.user.id,score)\r\n      pageContent = (\r\n        <EndScreen\r\n          score={score}\r\n          onRetryClick={restartGame}\r\n          playTime={playTimeInSeconds}\r\n          session = {session}\r\n        />\r\n      );\r\n  } else {\r\n    pageKey = triviaIndex;\r\n    const triviaQuestion = quizData[triviaIndex];\r\n    const { correct_answer, incorrect_answers, question, difficulty } = triviaQuestion;\r\n    pageContent = (\r\n      <QuizItem\r\n        key={triviaIndex}\r\n        question={question}\r\n        difficulty={difficulty}\r\n        correctAnswer={correct_answer}\r\n        incorrectAnswers={incorrect_answers}\r\n        onNextClick={loadNextQuestion}\r\n        onAnswerSelected={onAnswerSelected}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <br></br>\r\n      <Score score={score} questionNumber={questionNumber} totalQuestions={numQuestions} />\r\n      {pageContent}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Game;"],"mappings":"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"},"metadata":{},"sourceType":"module"}